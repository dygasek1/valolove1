<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Zagramy w Valo?</title>
  <style>
    body {
      margin: 0;
      background: radial-gradient(ellipse at center, #1a1a1a, #000);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: 'Segoe UI', sans-serif;
      color: #ff4d4d;
      overflow: hidden;
      position: relative;
      user-select: none;
    }

    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s ease-in-out;
      z-index: 1;
    }

    canvas {
      image-rendering: pixelated;
      filter: drop-shadow(0 0 12px red);
      z-index: 2;
      /* centrum animacji */
      transform-origin: center center;
    }

    .text {
      margin-top: 30px;
      font-size: 2rem;
      font-weight: bold;
      text-shadow: 0 0 10px #ff1a1a, 0 0 20px #ff4d4d;
      animation: pulseText 2s infinite ease-in-out;
      z-index: 2;
    }

    @keyframes pulseText {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.08); opacity: 0.85; }
    }

    .buttons {
      margin-top: 20px;
      display: flex;
      gap: 30px;
      z-index: 2;
    }

    button {
      background-color: #cc0000;
      border: none;
      padding: 12px 30px;
      font-size: 1.25rem;
      font-weight: bold;
      color: white;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 0 10px #ff3b3b;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    button:hover {
      background-color: #ff4d4d;
      transform: scale(1.1);
    }

    button:active {
      transform: scale(0.95);
    }

    #smutny-komunikat {
      color: #ff4d4d;
      font-size: 1.5rem;
      margin-top: 15px;
      z-index: 2;
    }

    .teardrop {
      position: absolute;
      top: -40px;
      width: 20px;
      height: 30px;
      background: #66ccff;
      border-radius: 50% 50% 60% 60%;
      opacity: 0.8;
      animation: fall 3s linear forwards;
      z-index: 2;
      transform: rotate(15deg);
    }

    @keyframes fall {
      to {
        transform: translateY(110vh) rotate(15deg);
        opacity: 0;
      }
    }

    /* UÅ›miech pod sercem */
    #smile {
      font-size: 4rem;
      margin-top: 20px;
      color: #fff;
      text-shadow: 0 0 8px #00ff00;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      user-select: none;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div id="overlay"></div>

  <canvas id="serceCanvas" width="450" height="450"></canvas>
  <div class="text">Zagramy w Valo? ðŸ’˜</div>

  <div class="buttons">
    <button id="btnTak">Tak</button>
    <button id="btnNie">Nie</button>
  </div>

  <div id="smile">ðŸ˜Š</div>

  <audio id="heartBreakSound" src="https://www.soundjay.com/human/sounds/sigh-01.mp3"></audio>

  <script>
    const heartPattern = [
      [0,0,1,1,0,1,1,0,0],
      [0,1,1,1,1,1,1,1,0],
      [1,1,1,1,1,1,1,1,1],
      [1,1,1,1,1,1,1,1,1],
      [0,1,1,1,1,1,1,1,0],
      [0,0,1,1,1,1,1,0,0],
      [0,0,0,1,1,1,0,0,0],
      [0,0,0,0,1,0,0,0,0]
    ];

    const heartPatternBroken = [
      [0,0,1,1,0,0,1,1,0],
      [0,1,1,1,1,0,1,1,1],
      [1,1,1,1,0,1,1,1,1],
      [1,1,1,0,1,1,1,1,1],
      [0,1,1,1,0,1,1,1,0],
      [0,0,1,1,1,0,1,0,0],
      [0,0,0,1,1,0,0,0,0],
      [0,0,0,0,1,0,0,0,0]
    ];

    const canvas = document.getElementById("serceCanvas");
    const ctx = canvas.getContext("2d");
    const baseSize = 40;
    let heartBroken = false;
    let animateHeart = true;
    let shakeStartTime = null;

    function drawHeart(scale, offsetXAnim=0, rotateAngle=0) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const pattern = heartBroken ? heartPatternBroken : heartPattern;
      const size = baseSize * scale;
      const offsetX = (canvas.width - pattern[0].length * size) / 2 + offsetXAnim;
      const offsetY = (canvas.height - pattern.length * size) / 2;

      ctx.save();
      ctx.translate(canvas.width / 2, canvas.height / 2);
      ctx.rotate(rotateAngle);
      ctx.translate(-canvas.width / 2, -canvas.height / 2);

      for(let y=0; y < pattern.length; y++) {
        for(let x=0; x < pattern[y].length; x++) {
          if(pattern[y][x]) {
            const px = offsetX + x*size;
            const py = offsetY + y*size;

            const grad = ctx.createRadialGradient(px + size/2, py + size/2, size/4, px + size/2, py + size/2, size);
            grad.addColorStop(0, "#ff5f5f");
            grad.addColorStop(1, "#cc0000");

            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.roundRect(px, py, size, size, size * 0.3);
            ctx.fill();
          }
        }
      }
      ctx.restore();
    }

    if(!CanvasRenderingContext2D.prototype.roundRect) {
      CanvasRenderingContext2D.prototype.roundRect = function(x,y,w,h,r) {
        if(w < 2*r) r = w/2;
        if(h < 2*r) r = h/2;
        this.beginPath();
        this.moveTo(x+r, y);
        this.arcTo(x+w, y, x+w, y+h, r);
        this.arcTo(x+w, y+h, x, y+h, r);
        this.arcTo(x, y+h, x, y, r);
        this.arcTo(x, y, x+w, y, r);
        this.closePath();
        return this;
      };
    }

    function animate(time=0) {
      const t = time / 400;
      if (animateHeart) {
        // ZwykÅ‚a pulsacja serca (powiÄ™kszenie/zmniejszenie)
        let scale = 1 + 0.1 * Math.sin(t);

        // JeÅ›li jest ruch (po klikniÄ™ciu Tak), dodajemy lekkie przesuniÄ™cia i obrÃ³t
        if (shakeStartTime !== null) {
          const elapsed = (time - shakeStartTime) / 1000; // sekundy
          const shakeAmount = 5; // px przesuniÄ™cie
          const rotationAmount = 0.05; // radiany (~3 stopnie)
          const shakeX = Math.sin(elapsed * 15) * shakeAmount;
          const rotate = Math.sin(elapsed * 20) * rotationAmount;
          drawHeart(scale, shakeX, rotate);
        } else {
          drawHeart(scale);
        }
      }
      requestAnimationFrame(animate);
    }

    animate();

    const btnTak = document.getElementById("btnTak");
    const btnNie = document.getElementById("btnNie");
    const buttonsDiv = document.querySelector(".buttons");
    const smile = document.getElementById("smile");
    const overlay = document.getElementById("overlay");

    btnTak.addEventListener("click", () => {
      // Reset smutny komunikat i przyciemnienie jeÅ›li byÅ‚y
      const oldMsg = document.getElementById("smutny-komunikat");
      if (oldMsg) oldMsg.remove();
      overlay.style.opacity = "0";

      // PrzestaÅ„ Å‚amaÄ‡ serce, bo klikniÄ™to TAK
      heartBroken = false;

      // Start animacji ruszajÄ…cego siÄ™ serca
      shakeStartTime = performance.now();

      // PokaÅ¼ uÅ›miech i ustaw opacity na 1
      smile.style.opacity = "1";

      // OtwÃ³rz link YouTube (jak wczeÅ›niej)
      window.open("https://www.youtube.com/watch?v=NSU2hJ5wT08&ab_channel=YadroGreenScreen", "_blank");
    });

    btnNie.addEventListener("click", () => {
      // UsuÅ„ poprzedni komunikat
      const oldMsg = document.getElementById("smutny-komunikat");
      if (oldMsg) oldMsg.remove();

      // Dodaj komunikat
      const msg = document.createElement("div");
      msg.id = "smutny-komunikat";
      msg.textContent = "Dlaczego!? ðŸ˜¢";
      buttonsDiv.after(msg);

      // Przyciemnij tÅ‚o
      overlay.style.opacity = "1";

      // ZmieÅ„ na pÄ™kniÄ™te serce
      heartBroken = true;

      // Schowaj uÅ›miech i wyÅ‚Ä…cz ruch serca
      smile.style.opacity = "0";
      shakeStartTime = null;

      // DÅºwiÄ™k pÄ™kniÄ™cia
      const heartbreakSound = document.getElementById("heartBreakSound");
      heartbreakSound.currentTime = 0;
      heartbreakSound.play().catch(e => console.warn("DÅºwiÄ™k musi byÄ‡ odtworzony po interakcji:", e));

      // OtwÃ³rz muzykÄ™
      window.open("https://www.youtube.com/watch?v=tYPSvBU1EZo&ab_channel=THENOCOPYRIGHTLIBRARY", "_blank");

      // Åzy (ciÄ…gÅ‚e)
      if (!window.tearsInterval) {
        window.tearsInterval = setInterval(() => {
          const drop = document.createElement("div");
          drop.classList.add("teardrop");
          drop.style.left = `${Math.random() * window.innerWidth}px`;
          document.body.appendChild(drop);
          setTimeout(() => drop.remove(), 4000);
        }, 300);
      }
    });
  </script>
</body>
</html>
